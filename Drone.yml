#Drone CI File!
#Commit Message: Drone! Captain Canary is here! 

kind: pipeline
type: kubernetes
name: API


steps:
- name: restore
  image: plugins/s3-cache
  settings:
    pull: true
    endpoint: https://s3.us-west-2.amazonaws.com/artifactory-cicd-drone
    path: api/
    access_key:
      from_secret: AWS_ID
    secret_key: 
      from_secret: AWS_SECRET
    restore: true
    debug: true

- name: build
  pull: default
  image: maven:3.6-openjdk-8-slim
  commands:
    - "mvn -Dskiptests clean install"
    - ls ./target -la
    - ls -al /root
    - ls -al /root/.m2
    - ls -al .mvn
    - ls -al ../
    - ls -al ~/
    - whoami
  volumes:
    - name: m2
      path: /root/.m2
      
- name: rebuild
  image: plugins/s3-cache
  settings:
    pull: true
    endpoint: https://s3.us-west-2.amazonaws.com/artifactory-cicd-drone
    access_key:
      from_secret: AWS_ID
    secret_key: 
      from_secret: AWS_SECRET
    rebuild: true
    debug: true
    path: api/
    mount:
      - /root/.m2
    
- name: checkbox
  image: busybox
  commands:
    - ls -al target
    - ls -al /root
    - ls -al .mvn
    - ls -al 
    - df -h

