#Drone CI File!
#Commit Message: Drone! Captain Canary is here! 

kind: pipeline
type: kubernetes
name: API

globals:
  - &AWS_AUTH
    ID: 
      from_secret: AWS_ID
    SECRET:
      from_secret: AWS_SECRET

steps:
  - name: restore-cache-with-gzip
    image: meltwater/drone-cache:dev
    pull: true
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: AWS_ID
      AWS_SECRET_ACCESS_KEY:
        from_secret: AWS_SECRET
    settings:
      restore: true
      cache_key: "gzip"
      archive_format: "gzip"
      bucket: artifactory-cicd-drone
      region: us-west-2
      mount:
        - 'vendor'
  - name: build
    pull: default
    image: maven:3.6-openjdk-8-slim
    commands:
      - "mvn -Dskiptests clean install"
      - ls ./target -la
      - ls -al /root
      - ls -al /root/.m2
      - ls -al .mvn
      - ls -al 
      - find / -iname vendor
      - df -h
    
  - name: rebuild-cache-with-gzip
    image: meltwater/drone-cache:dev
    pull: true
    environment:
      AWS_ACCESS_KEY_ID:
        from_secret: AWS_ID
      AWS_SECRET_ACCESS_KEY:
        from_secret: AWS_SECRET
    settings:
      rebuild: true
      cache_key: "gzip"
      archive_format: "gzip"
      bucket: artifactory-cicd-drone
      region: us-west-2
      mount:
        - 'vendor'
        
  - name: checkbox
    image: busybox
    commands:
      - ls -al target
      - ls -al /root
      - ls -al .mvn
      - ls -al 
      - df -h

