#Drone CI File!
#Commit Message: Drone! Captain Canary is here! 

kind: pipeline
type: kubernetes
name: default

steps:
- name: restore
  image: plugins/s3-cache
  settings:
    pull: true
    endpoint: https://artifactory-cicd-drone.s3-us-west-2.amazonaws.com
    access_key:
      from_secret: AWS_ID
    secret_key:
      from_secret: AWS_SECRET
    restore: true
- name: build
  image: maven:3.6-openjdk-8-slim
  commands:
    - "mvn -Dskiptests clean install"
    #- "mvn -DskipTests=true -Dmaven.javadoc.skip=true -B -V"
  depends_on:
  - restore
- name: test
  image: maven:3.6-openjdk-8
  commands:
    - "mvn test -B"
  depends_on:
  - restore
- name: rebuild
  image: plugins/s3-cache
  settings:
    pull: true
    endpoint: endpoint: https://artifactory-cicd-drone.s3-us-west-2.amazonaws.com
    access_key:
      from_secret: AWS_ID
    secret_key:
      from_secret: AWS_SECRET
    rebuild: true
    mount:
      - m2
  depends_on:
  - build
  - test
- name: Target
  image: busybox
  commands:
    - "ls -al -R target/*"
  depends_on:
  - rebuild
